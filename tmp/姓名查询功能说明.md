# 数据对比功能 - 姓名查询功能说明

## ✅ 新增功能

数据对比功能现已支持**按姓名查询**历史记录！

## 📋 功能说明

### 支持的查询方式

1. **按手机号查询**（原有功能）
   - 输入用户的手机号
   - 查询该手机号的所有填写记录

2. **按姓名查询**（新增功能）
   - 输入用户的姓名
   - 查询该姓名的所有填写记录

## 🚀 使用方法

### 步骤1：进入数据对比页面
```
访问：http://localhost:5000/admin/compare
或从管理后台导航栏点击「数据对比」
```

### 步骤2：选择查询类型
- 点击「按手机号查询」或「按姓名查询」按钮
- 按钮会高亮显示当前选择的查询类型

### 步骤3：输入查询条件
- 如果选择「按手机号查询」：输入手机号（如：13800138000）
- 如果选择「按姓名查询」：输入姓名（如：张三）

### 步骤4：查询历史记录
- 点击「查询历史」按钮
- 或按 Enter 键快速查询

### 步骤5：选择对比版本
- 勾选2-3个需要对比的版本
- 点击「开始对比」查看结果

## 📸 界面说明

```
┌─────────────────────────────────────────────┐
│  选择对比对象                               │
│  输入手机号或姓名查询该用户的所有填写记录   │
├─────────────────────────────────────────────┤
│  [按手机号查询] [按姓名查询]               │  ← 查询类型选择
│                                              │
│  ┌──────────────────────────────────────┐  │
│  │ 请输入手机号 / 请输入姓名           │  │  ← 动态提示
│  └──────────────────────────────────────┘  │
│                                              │
│  [查询历史]                                 │
└─────────────────────────────────────────────┘
```

## 💡 使用技巧

### 技巧1：快速切换查询类型
```
场景：你记不清用户的手机号，但记得姓名
操作：点击「按姓名查询」，输入姓名，点击查询
```

### 技巧2：按 Enter 快速查询
```
在输入框中输入完成后，直接按 Enter 键即可查询，
无需点击「查询历史」按钮
```

### 技巧3：查询同名的多个用户
```
如果多个用户使用相同的姓名（如「李明」），
系统会显示所有同名用户的历史记录
```

## ⚠️ 注意事项

1. **姓名查询是精确匹配**
   - 必须输入完整的姓名
   - 区分大小写（但中文通常不受影响）

2. **同名的多个用户**
   - 如果多个用户同名，会显示所有同名用户的记录
   - 请根据其他信息（如手机号、年龄）来区分

3. **优先使用手机号查询**
   - 手机号是唯一的，查询结果更准确
   - 姓名可能重复，需要进一步确认

4. **查询结果排序**
   - 按填写时间倒序排列
   - 最新的记录显示在最前面

## 🎯 实际应用场景

### 场景1：忘记手机号
```
情况：管理员记得用户姓名，但忘记手机号
解决：使用姓名查询功能，输入姓名即可查找
```

### 场景2：快速查找
```
情况：需要快速查看某个用户的多次填写记录
解决：直接输入姓名查询，比查找手机号更快捷
```

### 场景3：批量管理
```
情况：需要查看某个地区同名用户的健康数据
解决：使用姓名查询，快速找到所有相关记录
```

## 🔍 查询结果说明

查询结果表格显示以下信息：

| 列名 | 说明 |
|------|------|
| 选择 | 勾选框，用于选择对比版本 |
| 填写次数 | 第N次填写 |
| 填写时间 | 数据填写的时间 |
| 姓名 | 用户姓名 |
| 年龄 | 用户年龄 |
| 性别 | 用户性别 |
| BMI | 身体质量指数 |
| 状态 | 最新版本 / 历史版本 |
| 操作 | 查看详情按钮 |

## 📝 API 说明

### 接口地址
```
GET /api/user/history
```

### 请求参数
```
- phone: 手机号（可选）
- name: 姓名（可选）
- phoneGroupId: 手机组ID（可选）

注意：phone、name、phoneGroupId 三选一
```

### 响应示例
```json
{
  "success": true,
  "users": [
    {
      "id": "xxx",
      "name": "张三",
      "phone": "13800138000",
      "age": 35,
      "gender": "男",
      "bmi": "25.9",
      "createdAt": "2024-04-01T09:15:00.000Z",
      "isLatestVersion": true
    }
  ],
  "count": 1
}
```

## 🛠️ 技术实现

### 后端实现
1. **新增方法**：`healthDataManager.getUsersByName()`
   - 支持通过姓名查询用户记录
   - 支持排除已删除记录
   - 按创建时间倒序排列

2. **API 更新**：`/api/user/history`
   - 支持 `name` 参数
   - 与 `phone`、`phoneGroupId` 参数并列

### 前端实现
1. **状态管理**
   - 新增 `queryType` 状态：`phone` 或 `name`
   - 新增 `name` 状态：存储姓名输入

2. **UI 更新**
   - 添加查询类型切换按钮
   - 动态显示输入框提示文字
   - 支持 Enter 键快捷查询

## 📊 对比结果展示

查询历史记录后，可以进行数据对比：

### 对比内容
1. **基本信息**：姓名、年龄、性别、身高、体重、BMI
2. **趋势分析**：BMI 变化趋势（上升/下降/稳定）
3. **健康指标**：7大健康要素的变化

### 趋势图标
- 🔴 上升趋势：需要注意
- 🟢 下降趋势：改善中
- 🔵 稳定：状态良好

## 🧪 测试建议

### 测试用例1：按姓名查询已知用户
```
1. 选择「按姓名查询」
2. 输入已存在的用户姓名（如：张三）
3. 点击「查询历史」
4. 验证：显示该用户的所有历史记录
```

### 测试用例2：按手机号查询
```
1. 选择「按手机号查询」
2. 输入已存在的手机号（如：13800138000）
3. 点击「查询历史」
4. 验证：显示该手机号的所有历史记录
```

### 测试用例3：查询不存在的用户
```
1. 输入不存在的姓名或手机号
2. 点击「查询历史」
3. 验证：提示"未找到历史记录"
```

### 测试用例4：快速切换查询类型
```
1. 选择「按手机号查询」并输入手机号
2. 切换到「按姓名查询」
3. 验证：输入框清空，提示文字变为"请输入姓名"
```

## 📞 问题排查

### 问题1：查询不到数据
**可能原因**：
- 输入的姓名不正确
- 该用户已删除
- 该用户没有历史记录

**解决方法**：
- 检查姓名拼写是否正确
- 使用手机号查询作为验证
- 查看数据库中是否存在该用户

### 问题2：查询结果太多
**可能原因**：
- 查询的姓名太常见
- 多个用户使用相同姓名

**解决方法**：
- 使用手机号精确查询
- 结合年龄、性别等信息区分

### 问题3：切换查询类型后输入框不显示
**可能原因**：
- 浏览器缓存问题
- 前端渲染异常

**解决方法**：
- 刷新页面
- 清除浏览器缓存

## 🎉 功能优势

1. **灵活性提升**：支持两种查询方式，满足不同场景需求
2. **用户体验优化**：无需记住手机号，通过姓名即可查询
3. **操作便捷**：一键切换查询类型，支持 Enter 快捷键
4. **数据完整**：查询结果包含完整的用户信息

## 📚 相关文档

- [数据对比功能使用指南](./数据对比功能使用指南.md)
- [数据对比功能快速演示](./数据对比功能快速演示.md)
- [对比功能界面演示](./对比功能界面演示.html)

---

**版本**：v2.0
**更新时间**：2024年
**新增功能**：姓名查询支持
