# 健康自检应用 - 数据对比功能使用指南

## 功能概述

数据对比功能允许管理员对比同一用户在不同时期填写的健康自检数据，帮助追踪用户健康状况的变化趋势。每次用户填写数据时都会创建一条新的历史记录，所有数据都通过手机号关联。

## 功能入口

数据对比功能有两个入口：

### 入口一：管理后台导航栏
1. 登录管理后台：`http://localhost:5000/admin/login`
2. 进入管理后台首页
3. 在顶部导航栏点击"数据对比"按钮

### 入口二：用户列表历史记录
1. 登录管理后台
2. 在用户列表中找到有手机号的用户
3. 点击"历史记录"按钮
4. 在历史记录对话框中可以看到用户的多次填写记录

## 使用步骤

### 第一步：进入数据对比页面

**方式1：通过导航栏**
```
管理后台首页 → 点击"数据对比"按钮
```

**方式2：通过URL**
```
直接访问：http://localhost:5000/admin/compare
```

### 第二步：输入手机号查询历史记录

1. 在"选择对比对象"卡片中，输入用户的手机号
2. 点击"查询历史"按钮
3. 系统会显示该用户的所有填写记录（包括最新版本和历史版本）

### 第三步：选择需要对比的版本

- 每个版本会显示以下信息：
  - 填写次数（第1次、第2次等）
  - 填写时间
  - 姓名
  - 年龄
  - 性别
  - BMI
  - 状态（最新/历史）

- 选择版本：
  - 点击复选框勾选需要对比的版本
  - 最少选择2个版本，最多选择3个版本
  - 选中后会显示"已选择 X/3 个版本"

### 第四步：开始对比

1. 勾选完成后，点击"开始对比"按钮
2. 系统会弹出对比结果对话框
3. 对比结果包含以下内容：

## 对比结果说明

### 1. 基本信息
- 填写时间：展示各版本的填写时间
- 姓名、年龄、性别：基本信息对比
- 身高、体重：展示数值变化
- BMI：展示BMI数值及变化趋势
  - 上升趋势 🔴：需要注意饮食和运动
  - 下降趋势 🟢：继续保持健康生活方式
  - 稳定 🔵：状态良好

### 2. 趋势分析
系统会自动分析BMI变化趋势：
- **上升**：红色提示，建议用户注意饮食和运动
- **下降**：绿色提示，鼓励用户继续保持健康生活方式
- **稳定**：蓝色提示，表示状态良好

### 3. 健康分析对比
展示7大健康要素的变化：
- 气血
- 循环
- 毒素
- 血脂
- 寒凉
- 免疫
- 情绪
- 整体健康

每个指标都会显示：
- 版本1的数值
- 版本2的数值
- 变化量（正数表示上升，负数表示下降）

## 实际应用场景

### 场景1：跟踪用户调理效果
- **目的**：评估健康管理方案的效果
- **操作**：
  1. 对比用户开始调理前后的数据
  2. 重点查看BMI变化和健康要素得分变化
  3. 根据变化趋势调整后续方案

### 场景2：发现问题趋势
- **目的**：及时发现健康指标恶化
- **操作**：
  1. 对比最近3次填写的数据
  2. 查看各健康要素的变化趋势
  3. 提醒用户关注恶化的指标

### 场景3：验证用户数据准确性
- **目的**：检查用户填写数据是否真实
- **操作**：
  1. 对比多次填写的数据
  2. 检查是否有异常变化（如BMI突然大幅变化）
  3. 必要时联系用户确认

## 注意事项

1. **手机号是关键**：只有填写了手机号的数据才能进行历史对比
2. **最多对比3个版本**：选择版本时最多勾选3个
3. **数据完整性**：某些早期数据可能不完整，对比时会显示"-"
4. **BMI计算**：BMI是根据身高和体重自动计算的，如果缺少身高或体重数据，BMI将无法计算
5. **时间顺序**：历史记录按时间倒序排列，最新的记录在前面

## 数据保存机制

系统采用以下机制保存历史数据：

1. **每次提交创建新记录**：用户每次填写都会创建新的用户记录
2. **手机号关联**：通过`phoneGroupId`关联同一手机号的所有记录
3. **版本标记**：
   - `isLatestVersion = true`：最新版本
   - `isLatestVersion = false`：历史版本
4. **数据完整性**：每次填写都会保存完整数据，不会覆盖旧数据

## 示例演示

假设用户张三（手机号：13800138000）填写了3次数据：

### 第一次填写（2024-01-01）
- 姓名：张三
- 年龄：35岁
- 身高：170cm
- 体重：80kg
- BMI：27.7

### 第二次填写（2024-04-01）
- 姓名：张三
- 年龄：35岁
- 身高：170cm
- 体重：78kg
- BMI：27.0

### 第三次填写（2024-07-01）
- 姓名：张三
- 年龄：36岁
- 身高：170cm
- 体重：75kg
- BMI：25.9

### 对比结果：
- BMI变化：27.7 → 27.0 → 25.9
- 趋势：下降1.8
- 评价：下降趋势，继续保持健康生活方式

## 技术支持

如有问题，请查看：
1. 管理后台日志：`/app/work/logs/bypass/app.log`
2. 数据库健康检查：`http://localhost:5000/api/health`
3. 用户详情页：查看完整数据记录

---

**版本**：v1.0
**更新时间**：2024年
