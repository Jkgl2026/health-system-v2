# PWA 访问错误解决方案

## 问题描述

用户在手机上安装了健康管理应用后，打开时出现以下错误：

```json
{
  "error_code": "instance_not_found_vefaas-ve39yphh-bnyarls4ob-d5q6fb03o5cqb91b5rag-sandbox",
  "error_message": "user specified instance vefaas-ve39yphh-bnyarls4ob-d5q6fb03o5cqb91b5rag-sandbox not found",
  "request_id": "5bdb38e7-b39a-94b7-9b48-b4ebf915356f"
}
```

## 错误原因

这个错误表明用户使用了**错误的访问地址**安装PWA应用。具体原因可能是：

1. **错误的地址类型**：用户可能在Coze平台的项目页面（code.coze.cn）上安装了应用
2. **地址混淆**：用户保存了过期的或错误的URL
3. **缓存问题**：浏览器缓存了旧的错误地址

## 正确的访问地址

✅ **正确的地址**：
```
https://cd776816-213e-4c84-af60-dbe5b397d82e.dev.coze.site
```

❌ **错误的地址示例**：
```
https://code.coze.cn/p/7598103135101599785/
```

## 如何区分正确和错误的地址

| 特征 | ✅ 正确的地址 | ❌ 错误的地址 |
|-----|------------|------------|
| 域名后缀 | `.dev.coze.site` | `code.coze.cn` |
| 是否包含项目ID | 不包含 | 包含 `/p/7598103135101599785` |
| 首次打开 | 直接显示"健康自我管理"首页 | 显示"欢迎使用扣子"登录页面 |
| 是否需要登录 | 不需要登录 | 可能需要登录 |

## 解决方案

### 步骤 1：卸载当前错误的应用

**Android 手机**：
- 长按应用图标
- 点击"卸载"

**iPhone (iOS)**：
- 长按应用图标
- 点击"删除应用"
- 确认删除

**电脑桌面**：
- 右键点击应用图标
- 选择"卸载"或"删除"

### 步骤 2：访问正确的地址

在浏览器中打开以下地址：
```
https://cd776816-213e-4c84-af60-dbe5b397d82e.dev.coze.site
```

### 步骤 3：重新安装应用

**Android/Chrome**：
1. 打开正确的地址后，等待几秒钟
2. 浏览器会自动弹出安装提示："安装应用到桌面"
3. 点击"安装"按钮

**iPhone (iOS)**：
1. 使用 Safari 浏览器打开正确的地址
2. 点击底部的"分享"按钮（向上箭头图标）
3. 向下滑动，点击"添加到主屏幕"
4. 点击"添加"按钮

**电脑 (Windows/Mac)**：
1. 使用 Chrome 或 Edge 浏览器打开正确的地址
2. 点击浏览器地址栏右侧的安装图标
3. 点击"安装"按钮

## 预防措施

### 1. 安装前检查

在安装前，请确认：
- ✅ 浏览器地址栏显示正确的域名（`.dev.coze.site`）
- ✅ 页面直接显示"健康自我管理"首页
- ✅ 没有显示登录页面

❌ **不要**在以下情况安装：
- ❌ 地址包含 `code.coze.cn`
- ❌ 页面显示"欢迎使用扣子"登录页面
- ❌ 需要输入手机号或验证码

### 2. 自动检测功能

应用已集成了以下自动检测功能：

1. **URL 警告横幅**：当使用错误的地址访问时，顶部会显示红色警告横幅
2. **自动跳转**：PWA 启动时会自动检测地址，如果错误则跳转到错误页面
3. **错误页面**：提供详细的错误说明和解决方案

## 技术实现

### 1. URL 检测组件

位置：`src/components/PWAUrlChecker.tsx`

```typescript
useEffect(() => {
  const isPWA = window.matchMedia('(display-mode: standalone)').matches;
  const currentHostname = window.location.hostname;
  const isCorrectHostname = currentHostname.includes('.dev.coze.site');

  if (isPWA && !isCorrectHostname) {
    // 跳转到错误页面
    window.location.href = '/error-page';
  }
}, []);
```

### 2. URL 警告横幅

位置：`src/components/UrlWarningBanner.tsx`

当检测到错误的地址时，在页面顶部显示警告横幅，包含：
- ❌ 警告图标
- 📋 正确的地址
- 🔗 "前往正确地址"按钮
- 📋 "复制"按钮

### 3. 错误页面

位置：`src/app/error-page/page.tsx`

提供详细的错误说明和解决方案：
- 当前使用的错误地址
- 正确的访问地址
- 重新安装步骤
- 如何区分正确和错误的地址

## 常见问题

### Q1：为什么会出现这个错误？

A：这是因为您使用的是Coze平台的项目页面地址，而不是实际部署的应用地址。Coze平台页面只能用于开发调试，不能直接作为生产环境使用。

### Q2：如何知道我使用的是正确的地址？

A：正确的地址：
- 包含 `.dev.coze.site`
- 直接显示"健康自我管理"首页
- 不需要登录

错误的地址：
- 包含 `code.coze.cn`
- 可能显示登录页面
- 打开后出现"instance_not_found"错误

### Q3：卸载后我的数据会丢失吗？

A：不会。您的数据存储在服务器端的数据库中，与PWA应用无关。卸载应用只会移除手机上的快捷方式，不会删除您的健康数据。

### Q4：重新安装后需要重新填写数据吗？

A：不需要。重新安装后，您的所有历史数据都会保留。您可以通过手机号或姓名查看之前的填写记录。

### Q5：如何防止再次安装错误的地址？

A：
1. 只从正确的地址安装（`cd776816-213e-4c84-af60-dbe5b397d82e.dev.coze.site`）
2. 安装前检查是否显示"健康自我管理"首页
3. 如果看到登录页面，立即停止并检查地址
4. 书签正确的地址，方便下次访问

## 联系支持

如果按照以上步骤操作后仍然无法解决问题，请联系技术支持。

---

**最后更新**：2026-01-25
**版本**：1.0
