# 错误提示使用指南

## 新增功能

个人信息页面现在包含详细的错误捕获和提示功能，当保存失败时会显示：

### 1. 错误摘要
- 显示主要的错误信息
- 提供解决建议

### 2. 详细信息（可折叠）
点击"查看详细信息"可以展开查看：
- 错误发生时间
- HTTP 状态码和状态文本
- 页面 URL
- 完整的错误数据（JSON 格式）

### 3. 复制错误信息
点击"复制错误信息"按钮，可以一键复制完整的错误报告，方便发送给技术支持。

### 4. 快速解决步骤
提供常见问题的快速解决步骤。

## 错误类型及解决方案

### 网络错误 (Status: 0)
**症状：**
```
网络请求失败，请检查网络连接或刷新页面重试
```

**解决方案：**
1. 检查网络连接
2. 刷新页面重试
3. 检查是否使用了 VPN 或代理

### 数据库错误 (Status: 500, 消息包含 "database")
**症状：**
```
数据库连接失败，请联系管理员初始化数据库
```

**解决方案：**
访问以下 URL 初始化数据库：
```
https://x4mrwzmnw9.coze.site/api/init-db
```

### 服务器错误 (Status: 500)
**症状：**
```
服务器内部错误，请稍后重试或联系技术支持
```

**解决方案：**
1. 等待几分钟后重试
2. 复制错误信息联系技术支持
3. 检查服务器日志

### 资源不存在 (Status: 404)
**症状：**
```
资源不存在，请联系管理员检查服务器配置
```

**解决方案：**
1. 确认 URL 正确
2. 联系管理员检查服务器配置
3. 重新部署应用

## 如何使用错误信息反馈问题

### 方法 1：复制错误信息
1. 在错误提示中点击"复制错误信息"按钮
2. 将复制的内容发送给技术支持

### 方法 2：手动收集
1. 打开浏览器控制台（F12）
2. 切换到 "Console" 标签页
3. 切换到 "Network" 标签页
4. 点击保存按钮
5. 找到失败的请求（红色标记）
6. 复制请求和响应的详细信息

## 错误信息示例

### 成功的错误报告示例
```
错误时间: 2026-01-23T15:45:30.123Z
页面URL: https://x4mrwzmnw9.coze.site/personal-info
错误状态: 500 Internal Server Error
错误信息: Database connection failed
详细信息: {
  "code": "ETIMEDOUT",
  "message": "Connection timeout"
}
```

## 联系技术支持

当遇到问题时，请提供以下信息：
1. 错误时间
2. 错误类型（网络错误、数据库错误、服务器错误）
3. 完整的错误信息（点击"复制错误信息"获取）
4. 浏览器控制台的完整日志
5. 操作步骤（如何重现问题）

## 常见问题排查流程

### 问题：保存时无反应
1. 检查浏览器控制台是否有 JavaScript 错误
2. 检查网络请求是否发送
3. 确认是否在保存中状态（按钮显示"保存中..."）

### 问题：保存成功但未跳转
1. 检查控制台是否有 JavaScript 错误
2. 检查响应的 `success` 字段是否为 `true`
3. 手动访问 `/check` 页面确认数据是否保存

### 问题：数据未保存到数据库
1. 检查 `/api/health` 接口返回的 `userCount` 是否增加
2. 检查数据库表是否存在
3. 检查数据库连接配置

## 自定义错误提示

如需修改错误提示，编辑 `src/app/personal-info/page.tsx` 中的以下部分：

```typescript
const getErrorSuggestion = (error: ErrorResponse) => {
  // 添加自定义的错误类型和解决方案
  if (error.status === 500 && error.message.includes('custom')) {
    return '自定义解决方案';
  }
  // ...
};
```

## 相关文件

- `src/app/personal-info/page.tsx` - 个人信息页面（包含错误提示）
- `src/app/api/user/route.ts` - 用户 API 路由
- `src/storage/database/healthDataManager.ts` - 数据库管理器
- `PRODUCTION_TROUBLESHOOTING.md` - 生产环境故障排查指南
