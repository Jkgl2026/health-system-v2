# 健康七问数据管理工具使用指南

## 📋 问题说明

部分用户虽然完成了"四个要求"，但没有填写"健康七问"，导致后台显示"未填写"。

### 常见原因

1. **跳过填写环节** - 用户没有访问 `/analysis` 页面
2. **保存失败** - 填写后保存失败但没有看到错误提示
3. **直接跳转** - 用户从其他页面直接跳转到后续页面

## 🔧 解决方案

我们创建了一个**健康七问数据管理工具**，让管理员可以：

### 1️⃣ 单个用户查询和补录

**访问路径**：`/admin/seven-questions-manager`

**操作步骤**：

1. 输入用户ID，点击"查询"
2. 查看用户的七问数据状态
3. 如果未填写，点击"补录/编辑"
4. 填写7个问题的答案
5. 点击"保存答案"

### 2️⃣ 批量检查缺少七问数据的用户

在页面底部有"批量检查"功能：

1. 点击"批量检查"按钮
2. 系统会自动查找所有缺少七问数据的用户
3. 显示用户列表（姓名、ID、注册时间）
4. 点击"查看详情"可以快速进入补录页面

## 📊 批量检查示例

```bash
# API 接口
GET /api/admin/find-users-missing-seven-questions

# 响应示例
{
  "success": true,
  "users": [
    {
      "id": "23f52f0e-b072-4b25-a8fb-a255261929c5",
      "name": "小雪",
      "phone": null,
      "createdAt": "2026-01-27T07:25:11.762Z",
      "requirementsCompleted": 4
    }
  ],
  "totalUsers": 31,
  "missingCount": 25,
  "completedCount": 6
}
```

## 🎯 使用建议

### 优先处理

建议优先处理以下用户：
1. **已完成四个要求**的用户（`requirementsCompleted: 4`）
2. **最近注册**的用户
3. **主动反馈**的用户

### 操作流程

```
1. 点击"批量检查"
   ↓
2. 查看缺少七问数据的用户列表
   ↓
3. 选择需要补录的用户
   ↓
4. 依次补录七问答案
   ↓
5. 确认保存成功
```

## 🔍 数据诊断

如果遇到问题，可以使用以下诊断工具：

### 1. 七问数据诊断页面

**访问路径**：`/diagnose-seven-questions`

输入用户ID，查看详细的七问数据情况。

### 2. 直接查询数据库

```sql
-- 查询用户的七问数据
SELECT
  user_id,
  seven_questions_answers,
  requirement1_completed,
  requirement2_completed,
  requirement3_completed,
  requirement4_completed,
  updated_at
FROM requirements
WHERE user_id = '用户ID';
```

## ⚠️ 注意事项

1. **数据格式** - 七问答案会自动保存为以下格式：
   ```json
   {
     "1": {
       "answer": "用户回答内容",
       "date": "2026-01-27T00:00:00.000Z"
     },
     "2": { ... },
     ...
   }
   ```

2. **覆盖机制** - 如果用户已有七问数据，新的保存会覆盖旧数据

3. **权限控制** - 只有管理员可以访问此工具

4. **数据备份** - 建议在批量操作前先备份数据

## 📈 统计数据

截止到 2026-01-27 的数据：

- **总用户数**：31
- **缺少七问数据**：25 (80.6%)
- **已完成七问**：6 (19.4%)

## 🚀 快速开始

### 方法1：通过后台管理页面

1. 登录后台管理：`/admin/dashboard`
2. 点击顶部的"七问管理"按钮
3. 开始使用

### 方法2：直接访问

访问：`/admin/seven-questions-manager`

## 📞 技术支持

如果遇到问题：

1. 查看浏览器控制台错误信息
2. 检查 API 响应状态
3. 联系技术支持团队

## 📝 更新日志

### 2026-01-27
- ✅ 创建七问数据管理工具
- ✅ 添加批量检查功能
- ✅ 添加单用户查询和补录功能
- ✅ 在后台管理页面添加快捷入口

---

**工具创建时间**：2026-01-27
**当前版本**：v1.0.0
