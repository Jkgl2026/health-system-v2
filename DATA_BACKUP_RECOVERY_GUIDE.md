# æ•°æ®å®‰å…¨ä¸å¤‡ä»½æ¢å¤æ“ä½œæŒ‡å—

## ğŸ“‹ ç›®å½•

1. [æ•°æ®å®‰å…¨æ¶æ„æ¦‚è¿°](#æ•°æ®å®‰å…¨æ¶æ„æ¦‚è¿°)
2. [å¤‡ä»½æ¢å¤åŠŸèƒ½è¯´æ˜](#å¤‡ä»½æ¢å¤åŠŸèƒ½è¯´æ˜)
3. [å¤‡ä»½æ“ä½œæŒ‡å—](#å¤‡ä»½æ“ä½œæŒ‡å—)
4. [æ¢å¤æ“ä½œæŒ‡å—](#æ¢å¤æ“ä½œæŒ‡å—)
5. [æ•°æ®å¯¼å‡ºå¯¼å…¥æŒ‡å—](#æ•°æ®å¯¼å‡ºå¯¼å…¥æŒ‡å—)
6. [æ•°æ®åº“è¿ç§»ä¸å›æ»š](#æ•°æ®åº“è¿ç§»ä¸å›æ»š)
7. [åº”æ€¥å¤„ç†æ–¹æ¡ˆ](#åº”æ€¥å¤„ç†æ–¹æ¡ˆ)
8. [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)

---

## æ•°æ®å®‰å…¨æ¶æ„æ¦‚è¿°

### å¤šå±‚é˜²æŠ¤æœºåˆ¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   æ•°æ®å®‰å…¨é˜²æŠ¤å±‚                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. å®¡è®¡æ—¥å¿—ï¼ˆå®æ—¶è®°å½•ï¼‰                                  â”‚
â”‚     â””â”€ è®°å½•æ‰€æœ‰å˜æ›´ï¼Œæ”¯æŒè¿½æº¯                             â”‚
â”‚                                                         â”‚
â”‚  2. è½¯åˆ é™¤ï¼ˆåˆ é™¤ä¿æŠ¤ï¼‰                                    â”‚
â”‚     â””â”€ æ ‡è®°åˆ é™¤ï¼Œå¯å¿«é€Ÿæ¢å¤                               â”‚
â”‚                                                         â”‚
â”‚  3. å¤‡ä»½ç³»ç»Ÿï¼ˆå®‰å…¨ç½‘ï¼‰                                    â”‚
â”‚     â”œâ”€ å…¨é‡å¤‡ä»½ï¼ˆå®Œæ•´æ•°æ®åº“å¿«ç…§ï¼‰                          â”‚
â”‚     â”œâ”€ å¢é‡å¤‡ä»½ï¼ˆå˜æ›´æ•°æ®ï¼‰                               â”‚
â”‚     â””â”€ è‡ªåŠ¨å¤‡ä»½ï¼ˆè¿ç§»å‰è‡ªåŠ¨åˆ›å»ºï¼‰                         â”‚
â”‚                                                         â”‚
â”‚  4. å¯¼å‡º/å¯¼å…¥ï¼ˆä¾¿æºæ€§ï¼‰                                   â”‚
â”‚     â””â”€ JSONæ ¼å¼ï¼Œæ”¯æŒè·¨ç¯å¢ƒè¿ç§»                           â”‚
â”‚                                                         â”‚
â”‚  5. è¿ç§»å›æ»šï¼ˆç»“æ„å˜æ›´ä¿æŠ¤ï¼‰                              â”‚
â”‚     â””â”€ æä¾›æ’¤é”€è„šæœ¬ï¼Œæ¢å¤è¡¨ç»“æ„                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒåŸåˆ™

1. **å¤‡ä»½ä¼˜å…ˆåŸåˆ™**ï¼šä»»ä½•ä¿®æ”¹æ“ä½œå‰å¿…é¡»å…ˆå¤‡ä»½
2. **å¯å›æ»šåŸåˆ™**ï¼šæ‰€æœ‰æ“ä½œéƒ½å¿…é¡»èƒ½å¤Ÿå›æ»š
3. **å¤šé‡ä¿æŠ¤åŸåˆ™**ï¼šå®¡è®¡æ—¥å¿— + è½¯åˆ é™¤ + å¤‡ä»½ + å¯¼å‡º
4. **è‡ªåŠ¨åŒ–åŸåˆ™**ï¼šæ”¯æŒè‡ªåŠ¨å®šæœŸå¤‡ä»½å’Œè¿ç§»å‰è‡ªåŠ¨å¤‡ä»½

---

## å¤‡ä»½æ¢å¤åŠŸèƒ½è¯´æ˜

### 1. æ•°æ®åº“å¤‡ä»½ç³»ç»Ÿ

#### åŠŸèƒ½ç‰¹æ€§
- âœ… **å…¨é‡å¤‡ä»½**ï¼šå¤‡ä»½æ‰€æœ‰è¡¨çš„æ•°æ®
- âœ… **å¢é‡å¤‡ä»½**ï¼šå¤‡ä»½å˜æ›´çš„æ•°æ®
- âœ… **è‡ªåŠ¨å¤‡ä»½**ï¼šè¿ç§»å‰è‡ªåŠ¨åˆ›å»ºå¤‡ä»½
- âœ… **å¤‡ä»½éªŒè¯**ï¼šéªŒè¯å¤‡ä»½å®Œæ•´æ€§
- âœ… **å¤‡ä»½ç®¡ç†**ï¼šåˆ—å‡ºã€åˆ é™¤ã€ä¸‹è½½å¤‡ä»½
- âœ… **å¯¹è±¡å­˜å‚¨**ï¼šå¤‡ä»½æ–‡ä»¶å­˜å‚¨åˆ°å¯¹è±¡å­˜å‚¨ï¼Œå®‰å…¨å¯é 

#### å¤‡ä»½å­˜å‚¨ä½ç½®
- å­˜å‚¨ä½ç½®ï¼šå¯¹è±¡å­˜å‚¨ï¼ˆS3å…¼å®¹ï¼‰
- å­˜å‚¨è·¯å¾„ï¼š`backups/{backupId}.json`
- æ–‡ä»¶æ ¼å¼ï¼šJSON
- åŒ…å«å†…å®¹ï¼šå…ƒæ•°æ® + æ‰€æœ‰è¡¨æ•°æ®

### 2. æ•°æ®æ¢å¤ç³»ç»Ÿ

#### åŠŸèƒ½ç‰¹æ€§
- âœ… **ä»å¤‡ä»½æ¢å¤**ï¼šé€‰æ‹©å¤‡ä»½æ–‡ä»¶æ¢å¤æ•°æ®åº“
- âœ… **å®Œæ•´æ€§éªŒè¯**ï¼šæ¢å¤å‰éªŒè¯å¤‡ä»½å®Œæ•´æ€§
- âœ… **é€‰æ‹©æ€§æ¢å¤**ï¼šå¯æ¢å¤å•ä¸ªè¡¨æˆ–å…¨éƒ¨è¡¨
- âœ… **æ¢å¤æ—¥å¿—**ï¼šè®°å½•æ¢å¤æ“ä½œ

### 3. æ•°æ®å¯¼å‡º/å¯¼å…¥

#### åŠŸèƒ½ç‰¹æ€§
- âœ… **å…¨é‡å¯¼å‡º**ï¼šå¯¼å‡ºæ‰€æœ‰è¡¨æ•°æ®
- âœ… **JSONæ ¼å¼**ï¼šæ˜“äºé˜…è¯»å’Œç¼–è¾‘
- âœ… **æ ¡éªŒå’ŒéªŒè¯**ï¼šç¡®ä¿æ•°æ®å®Œæ•´æ€§
- âœ… **å¯¼å…¥æ¨¡å¼**ï¼šæ”¯æŒè¦†ç›–å’Œè¿½åŠ æ¨¡å¼

### 4. è¿ç§»å›æ»šæœºåˆ¶

#### åŠŸèƒ½ç‰¹æ€§
- âœ… **è‡ªåŠ¨å¤‡ä»½**ï¼šè¿ç§»å‰è‡ªåŠ¨åˆ›å»ºå¤‡ä»½
- âœ… **è¿ç§»å†å²**ï¼šè®°å½•æ‰€æœ‰è¿ç§»æ“ä½œ
- âœ… **ä¸€é”®å›æ»š**ï¼šä»å¤‡ä»½æ¢å¤åˆ°è¿ç§»å‰çŠ¶æ€
- âœ… **è¿ç§»æ­¥éª¤**ï¼šæ”¯æŒå¤šæ­¥éª¤è¿ç§»å’Œå›æ»š

---

## å¤‡ä»½æ“ä½œæŒ‡å—

### åˆ›å»ºå…¨é‡å¤‡ä»½

**APIï¼š** `POST /api/backup/create`

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```bash
curl -X POST http://localhost:5000/api/backup/create \
  -H "Content-Type: application/json" \
  -d '{
    "backupType": "FULL",
    "createdBy": "ADMIN",
    "description": "æ‰‹åŠ¨å…¨é‡å¤‡ä»½"
  }'
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "success": true,
  "message": "å¤‡ä»½åˆ›å»ºæˆåŠŸ",
  "data": {
    "backupId": "backup-2025-01-15T10-30-00-a1b2c3d4",
    "backupType": "FULL",
    "backupDate": "2025-01-15T10:30:00.000Z",
    "tableCount": 7,
    "totalRecords": 150,
    "fileSize": 102400,
    "fileKey": "backups/backup-2025-01-15T10-30-00-a1b2c3d4.json",
    "checksum": "a1b2c3d4",
    "createdAt": "2025-01-15T10:30:00.000Z",
    "createdBy": "ADMIN"
  }
}
```

### åˆ›å»ºå¢é‡å¤‡ä»½

**APIï¼š** `POST /api/backup/create`

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```bash
curl -X POST http://localhost:5000/api/backup/create \
  -H "Content-Type: application/json" \
  -d '{
    "backupType": "INCREMENTAL",
    "previousBackupId": "backup-2025-01-15T10-00-00-a1b2c3d4",
    "createdBy": "ADMIN",
    "description": "å¢é‡å¤‡ä»½"
  }'
```

### åˆ—å‡ºæ‰€æœ‰å¤‡ä»½

**APIï¼š** `GET /api/backup/list`

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```bash
curl http://localhost:5000/api/backup/list
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "success": true,
  "message": "è·å–å¤‡ä»½åˆ—è¡¨æˆåŠŸ",
  "data": {
    "count": 5,
    "backups": [
      {
        "backupId": "backup-2025-01-15T10-30-00-a1b2c3d4",
        "backupType": "FULL",
        "backupDate": "2025-01-15T10:30:00.000Z",
        "tableCount": 7,
        "totalRecords": 150,
        "fileSize": "100.00 KB",
        "previousBackupId": null,
        "checksum": "a1b2c3d4",
        "createdBy": "ADMIN"
      }
    ]
  }
}
```

### éªŒè¯å¤‡ä»½å®Œæ•´æ€§

**APIï¼š** `GET /api/backup/verify?backupId=xxx`

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```bash
curl "http://localhost:5000/api/backup/verify?backupId=backup-2025-01-15T10-30-00-a1b2c3d4"
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "success": true,
  "message": "å¤‡ä»½éªŒè¯é€šè¿‡",
  "data": {
    "valid": true,
    "checksumMatch": true,
    "details": {
      "backupId": "backup-2025-01-15T10-30-00-a1b2c3d4",
      "backupType": "FULL",
      "backupDate": "2025-01-15T10:30:00.000Z",
      "tableCount": 7,
      "totalRecords": 150,
      "recordCounts": {
        "users": 50,
        "symptomChecks": 30,
        "healthAnalysis": 30,
        "userChoices": 20,
        "requirements": 15,
        "admins": 3,
        "auditLogs": 2
      },
      "expectedChecksum": "a1b2c3d4",
      "actualChecksum": "a1b2c3d4",
      "tablesMatch": true
    }
  }
}
```

### åˆ é™¤å¤‡ä»½

**APIï¼š** `DELETE /api/backup/delete?backupId=xxx`

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```bash
curl -X DELETE "http://localhost:5000/api/backup/delete?backupId=backup-2025-01-15T10-30-00-a1b2c3d4"
```

### ä¸‹è½½å¤‡ä»½æ–‡ä»¶

**APIï¼š** `GET /api/backup/download?backupId=xxx&expireTime=3600`

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```bash
curl "http://localhost:5000/api/backup/download?backupId=backup-2025-01-15T10-30-00-a1b2c3d4"
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "success": true,
  "message": "ç”Ÿæˆä¸‹è½½URLæˆåŠŸ",
  "data": {
    "downloadUrl": "https://storage.example.com/backups/backup-2025-01-15T10-30-00-a1b2c3d4.json?signature=xxx",
    "expireTime": 3600,
    "backupId": "backup-2025-01-15T10-30-00-a1b2c3d4"
  }
}
```

---

## æ¢å¤æ“ä½œæŒ‡å—

### ä»å¤‡ä»½æ¢å¤æ•°æ®åº“

**APIï¼š** `POST /api/backup/restore`

**âš ï¸ é‡è¦æé†’ï¼š**
1. æ¢å¤æ“ä½œä¼šè¦†ç›–ç°æœ‰æ•°æ®
2. å»ºè®®åœ¨æ¢å¤å‰å…ˆåˆ›å»ºå½“å‰çŠ¶æ€çš„å¤‡ä»½
3. æ¢å¤æ“ä½œä¸å¯é€†

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```bash
# 1. å…ˆåˆ›å»ºå½“å‰çŠ¶æ€çš„å¤‡ä»½
curl -X POST http://localhost:5000/api/backup/create \
  -H "Content-Type: application/json" \
  -d '{
    "backupType": "FULL",
    "createdBy": "ADMIN",
    "description": "æ¢å¤å‰çš„å®‰å…¨å¤‡ä»½"
  }'

# 2. ä»å¤‡ä»½æ¢å¤
curl -X POST http://localhost:5000/api/backup/restore \
  -H "Content-Type: application/json" \
  -d '{
    "backupId": "backup-2025-01-15T10-00-00-a1b2c3d4",
    "createdBy": "ADMIN",
    "description": "æ¢å¤åˆ°æŒ‡å®šå¤‡ä»½"
  }'
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "success": true,
  "message": "æ•°æ®åº“æ¢å¤æˆåŠŸ",
  "data": {
    "backupId": "backup-2025-01-15T10-00-00-a1b2c3d4",
    "backupDate": "2025-01-15T10:00:00.000Z",
    "restoredRecords": {
      "users": 50,
      "symptomChecks": 30,
      "healthAnalysis": 30,
      "userChoices": 20,
      "requirements": 15,
      "admins": 3,
      "auditLogs": 2
    }
  }
}
```

### æ¢å¤æµç¨‹

1. **éªŒè¯å¤‡ä»½**ï¼šæ£€æŸ¥å¤‡ä»½å®Œæ•´æ€§å’Œå¯ç”¨æ€§
2. **å½“å‰å¤‡ä»½**ï¼šåˆ›å»ºå½“å‰çŠ¶æ€çš„å¤‡ä»½ï¼ˆå¯é€‰ä½†æ¨èï¼‰
3. **æ‰§è¡Œæ¢å¤**ï¼šä»å¤‡ä»½æ¢å¤æ•°æ®åº“
4. **éªŒè¯æ¢å¤**ï¼šæ£€æŸ¥æ¢å¤åçš„æ•°æ®

---

## æ•°æ®å¯¼å‡ºå¯¼å…¥æŒ‡å—

### å¯¼å‡ºæ‰€æœ‰æ•°æ®

**APIï¼š** `POST /api/data/export`

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```bash
curl -X POST http://localhost:5000/api/data/export \
  -H "Content-Type: application/json" \
  -d '{
    "createdBy": "ADMIN",
    "description": "æ•°æ®å¯¼å‡º"
  }'
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "success": true,
  "message": "æ•°æ®å¯¼å‡ºæˆåŠŸ",
  "data": {
    "exportId": "export-2025-01-15T10-30-00-a1b2c3d4",
    "fileKey": "exports/export-2025-01-15T10-30-00-a1b2c3d4.json",
    "fileSize": 102400,
    "downloadUrl": "https://storage.example.com/exports/export-2025-01-15T10-30-00-a1b2c3d4.json?signature=xxx"
  }
}
```

### å¯¼å…¥æ•°æ®

**APIï¼š** `POST /api/data/import`

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```bash
# æ–¹å¼1ï¼šç›´æ¥æä¾›å¯¼å‡ºæ•°æ®
curl -X POST http://localhost:5000/api/data/import \
  -H "Content-Type: application/json" \
  -d '{
    "exportData": {
      "metadata": {
        "exportId": "export-2025-01-15T10-30-00-a1b2c3d4",
        "exportDate": "2025-01-15T10:30:00.000Z",
        "version": "1.0",
        "tables": ["users", "symptomChecks", ...],
        "recordCounts": {...},
        "checksum": "a1b2c3d4"
      },
      "data": {...}
    },
    "overwrite": false,
    "createdBy": "ADMIN"
  }'

# æ–¹å¼2ï¼šä»å¯¹è±¡å­˜å‚¨å¯¼å…¥
curl -X POST http://localhost:5000/api/data/import \
  -H "Content-Type: application/json" \
  -d '{
    "fileKey": "exports/export-2025-01-15T10-30-00-a1b2c3d4.json",
    "overwrite": false,
    "createdBy": "ADMIN"
  }'
```

### å¯¼å…¥æ¨¡å¼è¯´æ˜

- **overwrite: false**ï¼ˆé»˜è®¤ï¼‰ï¼š
  - åªæ’å…¥ä¸å­˜åœ¨çš„è®°å½•
  - ä¿ç•™ç°æœ‰æ•°æ®
  - é€‚åˆæ•°æ®è¿½åŠ åœºæ™¯

- **overwrite: true**ï¼š
  - æ’å…¥æˆ–æ›´æ–°è®°å½•
  - è¦†ç›–ç°æœ‰æ•°æ®
  - é€‚åˆæ•°æ®åŒæ­¥åœºæ™¯

---

## æ•°æ®åº“è¿ç§»ä¸å›æ»š

### æ‰§è¡Œæ•°æ®åº“è¿ç§»

**APIï¼š** `POST /api/migrate-db`

**åŠŸèƒ½ç‰¹æ€§ï¼š**
- âœ… è¿ç§»å‰è‡ªåŠ¨åˆ›å»ºå¤‡ä»½
- âœ… è®°å½•è¿ç§»å†å²
- âœ… æ”¯æŒå›æ»š
- âœ… å¹‚ç­‰æ“ä½œï¼ˆå¯é‡å¤æ‰§è¡Œï¼‰

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```bash
curl -X POST http://localhost:5000/api/migrate-db \
  -H "Content-Type: application/json" \
  -d '{
    "autoBackup": true,
    "createdBy": "ADMIN"
  }'
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "success": true,
  "message": "è¿ç§»æ‰§è¡ŒæˆåŠŸ",
  "data": {
    "migrationId": "migration-2025-01-15T10-30-00-a1b2c3d4",
    "backupId": "backup-2025-01-15T10-29-59-x1y2z3w4",
    "note": "å¦‚æœè¿ç§»å‡ºç°é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨è¿ç§»IDè¿›è¡Œå›æ»š"
  }
}
```

### å›æ»šè¿ç§»

**APIï¼š** `POST /api/migrate-db/rollback`

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```bash
curl -X POST http://localhost:5000/api/migrate-db/rollback \
  -H "Content-Type: application/json" \
  -d '{
    "migrationId": "migration-2025-01-15T10-30-00-a1b2c3d4",
    "createdBy": "ADMIN"
  }'
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "success": true,
  "message": "è¿ç§»å›æ»šæˆåŠŸ",
  "data": {
    "migrationId": "migration-2025-01-15T10-30-00-a1b2c3d4",
    "backupId": "backup-2025-01-15T10-29-59-x1y2z3w4"
  }
}
```

### æŸ¥çœ‹è¿ç§»å†å²

**APIï¼š** `GET /api/migrate-db/history`

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```bash
curl "http://localhost:5000/api/migrate-db/history?limit=50"
```

---

## åº”æ€¥å¤„ç†æ–¹æ¡ˆ

### åœºæ™¯1ï¼šè¯¯åˆ é™¤æ•°æ®

**å¿«é€Ÿæ¢å¤ï¼ˆæ¨èï¼‰ï¼š**
```bash
# 1. æŸ¥çœ‹å®¡è®¡æ—¥å¿—ï¼Œç¡®è®¤åˆ é™¤æ—¶é—´
curl "http://localhost:5000/api/get-audit-logs?tableName=users&limit=10"

# 2. ä½¿ç”¨è½¯åˆ é™¤æ¢å¤
curl -X POST http://localhost:5000/api/restore-user \
  -H "Content-Type: application/json" \
  -d '{"userId": "xxx"}'
```

**ä»å¤‡ä»½æ¢å¤ï¼š**
```bash
# 1. æ‰¾åˆ°æœ€è¿‘çš„å¤‡ä»½
curl "http://localhost:5000/api/backup/list"

# 2. ä»å¤‡ä»½æ¢å¤
curl -X POST http://localhost:5000/api/backup/restore \
  -H "Content-Type: application/json" \
  -d '{"backupId": "backup-xxx"}'
```

### åœºæ™¯2ï¼šæ•°æ®æŸå

**æ¢å¤æµç¨‹ï¼š**
```bash
# 1. æ£€æŸ¥æ•°æ®å®Œæ•´æ€§
curl "http://localhost:5000/api/check-data-integrity"

# 2. åˆ›å»ºå½“å‰çŠ¶æ€å¤‡ä»½ï¼ˆç”¨äºåˆ†æï¼‰
curl -X POST http://localhost:5000/api/backup/create \
  -H "Content-Type: application/json" \
  -d '{"backupType": "FULL", "createdBy": "ADMIN", "description": "æ•°æ®æŸåæ—¶çš„å¤‡ä»½"}'

# 3. ä»æœ€è¿‘çš„æ­£å¸¸å¤‡ä»½æ¢å¤
curl -X POST http://localhost:5000/api/backup/restore \
  -H "Content-Type: application/json" \
  -d '{"backupId": "backup-xxx-last-good"}'
```

### åœºæ™¯3ï¼šè¿ç§»å¤±è´¥

**å›æ»šæµç¨‹ï¼š**
```bash
# 1. æŸ¥çœ‹è¿ç§»å†å²
curl "http://localhost:5000/api/migrate-db/history"

# 2. å›æ»šå¤±è´¥çš„è¿ç§»
curl -X POST http://localhost:5000/api/migrate-db/rollback \
  -H "Content-Type: application/json" \
  -d '{"migrationId": "migration-xxx"}'
```

### åœºæ™¯4ï¼šéœ€è¦è¿ç§»æ•°æ®åˆ°å…¶ä»–ç¯å¢ƒ

**å¯¼å‡ºå¯¼å…¥æµç¨‹ï¼š**
```bash
# 1. å¯¼å‡ºæ•°æ®
curl -X POST http://localhost:5000/api/data/export \
  -H "Content-Type: application/json" \
  -d '{"createdBy": "ADMIN"}'

# 2. ä¸‹è½½å¯¼å‡ºæ–‡ä»¶ï¼ˆä½¿ç”¨è¿”å›çš„ downloadUrlï¼‰

# 3. åœ¨ç›®æ ‡ç¯å¢ƒå¯¼å…¥
curl -X POST http://localhost:5000/api/data/import \
  -H "Content-Type: application/json" \
  -d '{"fileKey": "exports/export-xxx.json", "overwrite": true}'
```

---

## æœ€ä½³å®è·µ

### 1. å®šæœŸå¤‡ä»½

**å»ºè®®ç­–ç•¥ï¼š**
- **å…¨é‡å¤‡ä»½**ï¼šæ¯å¤©å‡Œæ™¨2:00è‡ªåŠ¨æ‰§è¡Œ
- **å¢é‡å¤‡ä»½**ï¼šæ¯å°æ—¶è‡ªåŠ¨æ‰§è¡Œ
- **ä¿ç•™ç­–ç•¥**ï¼šæœ€è¿‘7å¤© + æ¯å‘¨1ä¸ªï¼ˆå…±4å‘¨ï¼‰

### 2. é‡è¦æ“ä½œå‰çš„å¤‡ä»½

**å¿…é¡»å¤‡ä»½çš„åœºæ™¯ï¼š**
- âœ… æ•°æ®åº“è¿ç§»
- âœ… æ‰¹é‡æ›´æ–°æ•°æ®
- âœ… è¡¨ç»“æ„ä¿®æ”¹
- âœ… é‡å¤§åŠŸèƒ½ä¸Šçº¿

**æ“ä½œæµç¨‹ï¼š**
```bash
# 1. åˆ›å»ºå¤‡ä»½
curl -X POST http://localhost:5000/api/backup/create \
  -H "Content-Type: application/json" \
  -d '{"backupType": "FULL", "createdBy": "ADMIN", "description": "æ“ä½œå‰çš„å®‰å…¨å¤‡ä»½"}'

# 2. æ‰§è¡Œæ“ä½œ
# ... æ‰§è¡Œä½ çš„æ“ä½œ ...

# 3. éªŒè¯ç»“æœ
# ... éªŒè¯æ“ä½œæ˜¯å¦æˆåŠŸ ...

# 4. å¦‚æœå¤±è´¥ï¼Œä»å¤‡ä»½æ¢å¤
curl -X POST http://localhost:5000/api/backup/restore \
  -H "Content-Type: application/json" \
  -d '{"backupId": "backup-xxx"}'
```

### 3. å¤‡ä»½éªŒè¯

**å®šæœŸéªŒè¯å¤‡ä»½ï¼š**
```bash
# æ¯å‘¨éªŒè¯æœ€è¿‘çš„å¤‡ä»½
curl "http://localhost:5000/api/backup/verify?backupId=backup-latest"
```

### 4. æ•°æ®å®Œæ•´æ€§æ£€æŸ¥

**å®šæœŸè¿è¡Œæ£€æŸ¥ï¼š**
```bash
# æ¯å¤©è¿è¡Œæ•°æ®å®Œæ•´æ€§æ£€æŸ¥
curl "http://localhost:5000/api/check-data-integrity"
```

### 5. å®¡è®¡æ—¥å¿—æŸ¥çœ‹

**å®šæœŸæŸ¥çœ‹å®¡è®¡æ—¥å¿—ï¼š**
```bash
# æŸ¥çœ‹æœ€è¿‘çš„æ•°æ®å˜æ›´
curl "http://localhost:5000/api/get-audit-logs?limit=50"
```

### 6. å¤‡ä»½æ–‡ä»¶ç®¡ç†

**æ¸…ç†æ—§å¤‡ä»½ï¼š**
```bash
# åˆ é™¤è¶…è¿‡30å¤©çš„å¤‡ä»½
curl -X DELETE "http://localhost:5000/api/backup/delete?backupId=backup-xxx-old"
```

### 7. å¤šé‡éªŒè¯

**é‡è¦æ“ä½œçš„å¤šé‡éªŒè¯ï¼š**
1. âœ… æ“ä½œå‰å¤‡ä»½
2. âœ… æ“ä½œåéªŒè¯
3. âœ… æŸ¥çœ‹å®¡è®¡æ—¥å¿—
4. âœ… è¿è¡Œæ•°æ®å®Œæ•´æ€§æ£€æŸ¥

---

## å®‰å…¨æ³¨æ„äº‹é¡¹

### âš ï¸ é‡è¦æé†’

1. **ç¦æ­¢åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ `/api/init-db`**
   - ä½¿ç”¨ `/api/migrate-db` æ›¿ä»£
   - è¿ç§»APIæ”¯æŒè‡ªåŠ¨å¤‡ä»½å’Œå›æ»š

2. **æ‰€æœ‰æ•°æ®æ“ä½œå¿…é¡»è®°å½•å®¡è®¡æ—¥å¿—**
   - ç³»ç»Ÿå·²è‡ªåŠ¨é›†æˆå®¡è®¡æ—¥å¿—
   - å¯é€šè¿‡ `/api/get-audit-logs` æŸ¥çœ‹

3. **ä¼˜å…ˆä½¿ç”¨è½¯åˆ é™¤è€Œéç‰©ç†åˆ é™¤**
   - è½¯åˆ é™¤å¯å¿«é€Ÿæ¢å¤
   - é¿å…æ•°æ®æ°¸ä¹…ä¸¢å¤±

4. **å®šæœŸå¤‡ä»½**
   - å»ºè®®æ¯å¤©è‡³å°‘ä¸€æ¬¡å…¨é‡å¤‡ä»½
   - é‡è¦æ“ä½œå‰æ‰‹åŠ¨å¤‡ä»½

5. **å¤‡ä»½éªŒè¯**
   - å®šæœŸéªŒè¯å¤‡ä»½å®Œæ•´æ€§
   - ç¡®ä¿å¤‡ä»½å¯ç”¨

6. **æƒé™æ§åˆ¶**
   - å¤‡ä»½å’Œæ¢å¤æ“ä½œéœ€è¦ç®¡ç†å‘˜æƒé™
   - è®°å½•æ“ä½œäººä¿¡æ¯

---

## API æ€»è§ˆ

### å¤‡ä»½ç›¸å…³

| API | æ–¹æ³• | æè¿° |
|-----|------|------|
| `/api/backup/create` | POST | åˆ›å»ºå¤‡ä»½ |
| `/api/backup/list` | GET | åˆ—å‡ºå¤‡ä»½ |
| `/api/backup/restore` | POST | ä»å¤‡ä»½æ¢å¤ |
| `/api/backup/verify` | GET | éªŒè¯å¤‡ä»½ |
| `/api/backup/delete` | DELETE | åˆ é™¤å¤‡ä»½ |
| `/api/backup/download` | GET | ä¸‹è½½å¤‡ä»½ |

### å¯¼å‡ºå¯¼å…¥ç›¸å…³

| API | æ–¹æ³• | æè¿° |
|-----|------|------|
| `/api/data/export` | POST | å¯¼å‡ºæ•°æ® |
| `/api/data/import` | POST | å¯¼å…¥æ•°æ® |

### è¿ç§»ç›¸å…³

| API | æ–¹æ³• | æè¿° |
|-----|------|------|
| `/api/migrate-db` | POST | æ‰§è¡Œè¿ç§» |
| `/api/migrate-db/rollback` | POST | å›æ»šè¿ç§» |
| `/api/migrate-db/history` | GET | è¿ç§»å†å² |

### å®¡è®¡æ—¥å¿—

| API | æ–¹æ³• | æè¿° |
|-----|------|------|
| `/api/get-audit-logs` | GET | è·å–å®¡è®¡æ—¥å¿— |

### æ•°æ®å®Œæ•´æ€§

| API | æ–¹æ³• | æè¿° |
|-----|------|------|
| `/api/check-data-integrity` | GET | æ£€æŸ¥æ•°æ®å®Œæ•´æ€§ |

---

## æ€»ç»“

æœ¬ç³»ç»Ÿæä¾›äº†å®Œæ•´çš„å¤‡ä»½æ¢å¤æœºåˆ¶ï¼ŒåŒ…æ‹¬ï¼š

âœ… **å¤šå±‚é˜²æŠ¤**ï¼šå®¡è®¡æ—¥å¿— + è½¯åˆ é™¤ + å¤‡ä»½ + å¯¼å‡º
âœ… **è‡ªåŠ¨å¤‡ä»½**ï¼šè¿ç§»å‰è‡ªåŠ¨åˆ›å»ºå¤‡ä»½
âœ… **å¿«é€Ÿæ¢å¤**ï¼šæ”¯æŒä»å¤‡ä»½å¿«é€Ÿæ¢å¤
âœ… **æ•°æ®éªŒè¯**ï¼šå¤‡ä»½å’Œæ•°æ®å®Œæ•´æ€§éªŒè¯
âœ… **è¿ç§»å›æ»š**ï¼šæ”¯æŒè¿ç§»å›æ»š
âœ… **ä¾¿æºæ€§**ï¼šJSONæ ¼å¼å¯¼å‡ºå¯¼å…¥

**å…³é”®åŸåˆ™ï¼š**
- å¤‡ä»½ä¼˜å…ˆï¼šä»»ä½•ä¿®æ”¹å‰å…ˆå¤‡ä»½
- å¯å›æ»šï¼šæ‰€æœ‰æ“ä½œéƒ½èƒ½å›æ»š
- å¤šé‡ä¿æŠ¤ï¼šå¤šå±‚æ¬¡çš„æ•°æ®å®‰å…¨ä¿éšœ
- è‡ªåŠ¨åŒ–ï¼šè‡ªåŠ¨å¤‡ä»½å’ŒéªŒè¯

é€šè¿‡éµå¾ªæœ¬æŒ‡å—ï¼Œä½ å¯ä»¥ç¡®ä¿æ•°æ®å®‰å…¨ï¼Œå¹¶åœ¨å‡ºç°é—®é¢˜æ—¶å¿«é€Ÿæ¢å¤ã€‚
