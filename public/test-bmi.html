<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BMI 测试页面</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background-color: #f5f5f5;
    }
    .card {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    h1 {
      color: #333;
    }
    .form-group {
      margin-bottom: 15px;
    }
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    input, select {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-sizing: border-box;
    }
    button {
      background-color: #4CAF50;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
    }
    button:hover {
      background-color: #45a049;
    }
    .result {
      background-color: #e7f3fe;
      border-left: 6px solid #2196F3;
      padding: 15px;
      margin-top: 20px;
    }
    .error {
      background-color: #ffebee;
      border-left: 6px solid #f44336;
      padding: 15px;
      margin-top: 20px;
      color: #c62828;
    }
    pre {
      background-color: #f9f9f9;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>BMI 测试页面</h1>
    <p>这个页面用于测试 BMI 计算和保存功能</p>

    <div class="form-group">
      <label for="name">姓名：</label>
      <input type="text" id="name" value="测试用户" />
    </div>

    <div class="form-group">
      <label for="age">年龄：</label>
      <input type="number" id="age" value="30" />
    </div>

    <div class="form-group">
      <label for="gender">性别：</label>
      <select id="gender">
        <option value="男">男</option>
        <option value="女">女</option>
      </select>
    </div>

    <div class="form-group">
      <label for="weight">体重（kg）：</label>
      <input type="number" id="weight" value="70" step="0.1" />
    </div>

    <div class="form-group">
      <label for="height">身高：</label>
      <input type="number" id="height" value="175" step="0.1" />
    </div>

    <button onclick="calculateAndSaveBMI()">计算并保存 BMI</button>
    <button onclick="loadUserInfo()" style="background-color: #2196F3;">加载用户信息</button>
    <button onclick="clearLocalStorage()" style="background-color: #f44336;">清除 localStorage</button>

    <div id="result" class="result" style="display: none;"></div>
  </div>

  <div class="card">
    <h2>LocalStorage 状态</h2>
    <button onclick="showLocalStorage()">显示 localStorage</button>
    <pre id="localStorageDisplay"></pre>
  </div>

  <script>
    function calculateBMI(weight, height) {
      const heightInMeters = height / 100;
      const bmi = weight / (heightInMeters * heightInMeters);
      return Math.round(bmi * 10) / 10;
    }

    function getBMICategory(bmi) {
      if (bmi < 18.5) return '偏瘦';
      if (bmi < 24) return '正常';
      if (bmi < 28) return '超重';
      return '肥胖';
    }

    function calculateAndSaveBMI() {
      const name = document.getElementById('name').value;
      const age = parseInt(document.getElementById('age').value);
      const gender = document.getElementById('gender').value;
      const weight = parseFloat(document.getElementById('weight').value);
      const height = parseFloat(document.getElementById('height').value);

      if (!weight || !height) {
        showError('请输入有效的体重和身高');
        return;
      }

      const bmi = calculateBMI(weight, height);
      const bmiCategory = getBMICategory(bmi);

      // 保存 userInfo 到 localStorage
      const userInfo = {
        name: name,
        age: age,
        gender: gender,
        height: height,
        weight: weight,
        bmi: bmi
      };

      localStorage.setItem('userInfo', JSON.stringify(userInfo));

      const resultHtml = `
        <h3>BMI 计算结果</h3>
        <p><strong>身高：</strong>${height} cm</p>
        <p><strong>体重：</strong>${weight} kg</p>
        <p><strong>BMI：</strong>${bmi}</p>
        <p><strong>分类：</strong>${bmiCategory}</p>
        <p><strong>状态：</strong>已保存到 localStorage</p>
        <p><strong>userInfo 对象：</strong></p>
        <pre>${JSON.stringify(userInfo, null, 2)}</pre>
      `;

      showResult(resultHtml);
    }

    function loadUserInfo() {
      const userInfoStr = localStorage.getItem('userInfo');

      if (!userInfoStr) {
        showError('localStorage 中没有 userInfo');
        return;
      }

      const userInfo = JSON.parse(userInfoStr);

      const resultHtml = `
        <h3>从 localStorage 加载的用户信息</h3>
        <pre>${JSON.stringify(userInfo, null, 2)}</pre>
        <p><strong>BMI 值：</strong>${userInfo.bmi || '未计算'}</p>
        <p><strong>BMI 分类：</strong>${getBMICategory(userInfo.bmi)}</p>
      `;

      showResult(resultHtml);

      // 填充表单
      document.getElementById('name').value = userInfo.name || '';
      document.getElementById('age').value = userInfo.age || '';
      document.getElementById('gender').value = userInfo.gender || '男';
      document.getElementById('weight').value = userInfo.weight || '';
      document.getElementById('height').value = userInfo.height || '';
    }

    function showLocalStorage() {
      const display = document.getElementById('localStorageDisplay');
      const data = {};

      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key && (key.includes('user') || key.includes('symptom') || key.includes('habit'))) {
          try {
            data[key] = JSON.parse(localStorage.getItem(key));
          } catch (e) {
            data[key] = localStorage.getItem(key);
          }
        }
      }

      display.textContent = JSON.stringify(data, null, 2);
    }

    function showResult(html) {
      const resultDiv = document.getElementById('result');
      resultDiv.innerHTML = html;
      resultDiv.style.display = 'block';
      resultDiv.className = 'result';
    }

    function showError(message) {
      const resultDiv = document.getElementById('result');
      resultDiv.innerHTML = `<p><strong>错误：</strong>${message}</p>`;
      resultDiv.style.display = 'block';
      resultDiv.className = 'error';
    }

    function clearLocalStorage() {
      if (confirm('确定要清除所有 localStorage 数据吗？')) {
        localStorage.clear();
        showResult('<p>localStorage 已清除</p>');
        document.getElementById('localStorageDisplay').textContent = '';
      }
    }

    // 页面加载时显示 localStorage
    window.onload = function() {
      showLocalStorage();
    };
  </script>
</body>
</html>
