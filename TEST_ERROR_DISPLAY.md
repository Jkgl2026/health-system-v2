# 错误提示功能测试指南

## 测试目的
验证新增的错误捕获和显示功能是否正常工作。

## 测试步骤

### 1. 测试正常保存（无错误）

**步骤：**
1. 访问个人信息页面：`http://localhost:5000/personal-info`
2. 填写完整表单：
   - 姓名：测试用户
   - 性别：男
   - 年龄：30
   - 体重：70
   - 身高：175
3. 点击"保存并继续"按钮

**预期结果：**
- 按钮显示"保存中..."
- 保存成功后跳转到 `/check` 页面
- 控制台显示保存日志

### 2. 测试网络错误

**步骤：**
1. 断开网络连接
2. 填写表单并保存

**预期结果：**
- 显示错误提示
- 错误信息：`网络请求失败，请检查网络连接或刷新页面重试`
- 状态码：0
- 可以复制错误信息
- 可以查看详细信息

### 3. 测试数据库未初始化错误

**步骤：**
1. 删除数据库表（仅用于测试，生产环境不要执行）
2. 访问个人信息页面并填写表单
3. 点击保存

**预期结果：**
- 显示错误提示
- 错误信息包含 `relation "users" does not exist`
- 提供解决方案：访问 `/api/init-db`

**恢复方法：**
```bash
curl -X POST http://localhost:5000/api/init-db
```

### 4. 测试服务器错误（模拟）

**步骤：**
1. 修改 API 路由，临时添加错误抛出：
```typescript
// src/app/api/user/route.ts
throw new Error('模拟服务器错误');
```
2. 访问页面并保存
3. 恢复代码

**预期结果：**
- 显示错误提示
- 错误信息：`模拟服务器错误`
- 状态码：500
- 提供解决方案：稍后重试或联系技术支持

### 5. 测试复制错误信息

**步骤：**
1. 触发任意错误
2. 点击"复制错误信息"按钮

**预期结果：**
- 按钮文字变为"已复制"
- 2 秒后恢复为"复制错误信息"
- 剪贴板包含完整的错误信息

### 6. 测试详细信息折叠/展开

**步骤：**
1. 触发任意错误
2. 点击"查看详细信息"

**预期结果：**
- 展开显示详细错误信息
- 包含：时间、状态码、URL、详细数据
- 再次点击可以折叠

## 验证清单

- [ ] 正常保存成功，无错误提示
- [ ] 网络错误时显示正确的错误提示
- [ ] 数据库错误时显示正确的错误提示
- [ ] 服务器错误时显示正确的错误提示
- [ ] 可以复制错误信息
- [ ] 可以展开/折叠详细信息
- [ ] 错误提示样式正确（红色边框、图标等）
- [ ] 快速解决步骤显示正确
- [ ] 错误信息格式正确

## 浏览器兼容性测试

请测试以下浏览器：
- [ ] Chrome
- [ ] Firefox
- [ ] Safari
- [ ] Edge

## 移动端测试

请测试以下设备：
- [ ] iOS Safari
- [ ] Android Chrome
- [ ] 小屏幕设备（小于 375px 宽）

## 性能测试

验证以下性能指标：
- [ ] 错误提示渲染时间 < 100ms
- [ ] 复制错误信息时间 < 500ms
- [ ] 详细信息展开/展开流畅
- [ ] 不影响正常保存性能

## 回归测试

确保以下功能仍然正常：
- [ ] 表单验证（必填字段）
- [ ] BMI 自动计算
- [ ] 数据保存成功
- [ ] 页面跳转
- [ ] 加载用户数据

## 测试报告模板

```markdown
## 测试报告
测试日期：2026-01-23
测试人员：[姓名]

### 测试结果
- 正常保存：✅ / ❌
- 网络错误：✅ / ❌
- 数据库错误：✅ / ❌
- 服务器错误：✅ / ❌
- 复制功能：✅ / ❌
- 详细信息：✅ / ❌

### 发现的问题
1. [问题描述]
2. [问题描述]

### 建议
1. [建议内容]
2. [建议内容]
```

## 注意事项

1. 测试网络错误时，确保可以恢复网络连接
2. 测试数据库错误后，记得恢复数据库状态
3. 不要在生产环境执行破坏性测试
4. 测试完成后，清理测试数据

## 联系支持

如发现问题，请联系开发团队并提供：
1. 浏览器类型和版本
2. 操作系统
3. 错误截图
4. 复制错误信息
5. 复现步骤
